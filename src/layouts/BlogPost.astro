---
import { type CollectionEntry, render } from "astro:content";

import Masthead from "@/components/blog/Masthead.astro";
// â¬‡  remove TOC import and add the new island
// import TOC from "@/components/blog/TOC.astro";
import ChatBotIsland from "@/components/chat/ChatBotIsland.astro";

import WebMentions from "@/components/blog/webmentions/index.astro";
import BaseLayout from "./Base.astro";

interface Props {
  post: CollectionEntry<"learn">;
}

const { post } = Astro.props;
const { ogImage, title, description, updatedDate, publishDate } = post.data;
const socialImage = ogImage ?? `/og-image/${post.id}.png`;
const articleDate = updatedDate?.toISOString() ?? publishDate.toISOString();
const { headings, remarkPluginFrontmatter } = await render(post);
const readingTime: string = remarkPluginFrontmatter.readingTime;
---

<BaseLayout
  meta={{
    articleDate,
    description,
    ogImage: socialImage,
    title,
  }}
>
  <article class="grow break-words" data-pagefind-body>
    <div id="blog-hero" class="mb-12">
      <Masthead content={post} readingTime={readingTime} />
    </div>

    <!-- main two-column wrapper -->
    <div class="flex flex-col gap-10 lg:flex-row lg:items-start">
      <!-- ðŸ“Œ new sidebar chat (sticky on large screens) -->
      <ChatBotIsland />

      <!-- MDX article -->
      <div
        class="prose max-w-none flex-1 min-w-0 lg:mx-auto
               prose-sm
               prose-headings:font-semibold
               prose-headings:text-accent-2
               prose-headings:before:absolute
               prose-headings:before:-ms-4
               prose-headings:before:text-gray-600
               prose-headings:hover:before:text-accent
               sm:prose-headings:before:content-['#']
               sm:prose-th:before:content-none"
      >
        <slot />
        <WebMentions />
      </div>
    </div>
  </article>

  <!-- back-to-top button (unchanged) -->
  <button â€¦> â€¦ </button>
</BaseLayout>

<script>
  /* existing scroll-to-top script â€“ unchanged */
</script>
